#! /bin/sh

function window {
	if [ "$1" = "editor" ]; then 
		tmux neww -n "$2" "cd $3 && zsh"
		tmux split-window -h -p 80 "cd $3 && zsh -is eval $EDITOR"
		tmux split-window -v -t 0 -p 75 "cd $3 && zsh -is eval dir $4"
	elif [ "$1" = "deluxe" ]; then
		tmux neww -n "$2" "cd $3 && zsh"
		tmux split-window -h -p 80 "cd $3 && zsh -is eval $EDITOR"
		tmux split-window -h "cd $3 && zsh"
		tmux split-window -v "cd $3 && zsh"
		tmux split-window -v -t 0 -p 75 "cd $3 && zsh -is eval dir $4"
	elif [ "$1" = "terms" ]; then
		tmux neww -n "$2" "cd $3 && zsh"
		tmux split-window -h "cd $3 && zsh"
		tmux split-window -v -t 0 "cd $3 && zsh"
		tmux split-window -v -t 2 "cd $3 && zsh"
	else
		tmux neww -n "$2" "cd $3 && zsh"
	fi
}

tmux has-session -t Main 2>/dev/null

if [ $? != 0 ]; then
	if [[ "$1" == "restart" ]]; then
		tmux kill-session -t Main
	fi

	tmux new -s Main -n Home -d -x - -y - 'cd ~ && zsh'
	tmux split-window -h "cd ~ && zsh"
	tmux split-window -v -t 0 "cd ~ && zsh"
	tmux split-window -v -t 2 "cd ~ && zsh"

	source ~/.workspaces
fi

if [ "$1" = "new" ]; then
	window "$2" "$3" "$4"
elif [ "$1" == "kill" ]; then
	tmux kill-session -t Main
else
	tmux attach-session -t Main
fi
